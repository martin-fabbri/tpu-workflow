schema: '2.0'
stages:
  download_file:
    cmd: gsutil cp gs://kaggle-data-tpu/test/test.txt test.txt
    deps:
    - path: gs://kaggle-data-tpu/test/test.txt
      md5: 74e24b46e2336dd063622ee49c96514d
      size: 22
    outs:
    - path: test.txt
      md5: 74e24b46e2336dd063622ee49c96514d
      size: 22
  download_file_2:
    cmd: gsutil cp gs://kaggle-data-tpu/test/test_2.txt test_2.txt
    deps:
    - path: remote://gcs_test/test_2.txt
      md5: 74e24b46e2336dd063622ee49c96514d
      size: 22
    outs:
    - path: test_2.txt
      md5: 74e24b46e2336dd063622ee49c96514d
      size: 22
  test_read_blob_gcs:
    cmd: python src/test.py
    deps:
    - path: remote://gcs_test/test_2.txt
      md5: 74e24b46e2336dd063622ee49c96514d
      size: 22
  test_list_objects_gcs:
    cmd: python src/test_list_blobs.py
    deps:
    - path: remote://gcs_test
      md5: 4c8d119295d08db866947dea99bd3272.dir
      size: 44
      nfiles: 2
  split:
    cmd: python3 src/pipeline/split.py --gcs-path gs://kaggle-data-tpu/images --train-split-path
      data/interim/train_split.json --val-split-path data/interim/val_split.json --images-count-path
      data/interim/images_count.json --validation-split 0.19 --image-size 331
    deps:
    - path: remote://gcs_images
      md5: 61d4627ec881871e7683b161b726e3ee.dir
      size: 1067709259
      nfiles: 3735
    - path: src/pipeline/split.py
      md5: 7e2d9421f9cac18bd18b4d7a55ab5f0d
      size: 3159
    outs:
    - path: data/interim/images_count.json
      md5: cb5f6e38428e031affe368e5e4b64351
      size: 59
    - path: data/interim/train_split.json
      md5: 990315c7d90f4d0d640be37145518a78
      size: 962
    - path: data/interim/val_split.json
      md5: 3a634df5d52902bd59ebd43b98844c22
      size: 222
  train:
    cmd: python src/pipeline/train.py --lr-start 1e-05 --classes-path data/domain/classes.json
      --image-size 331 --epochs 12 --batch-size 16 --train-split-path data/interim/train_split.json
      --val-split-path data/interim/val_split.json --images-count-path data/interim/images_count.json
      --saved-model-path models/xception_model.h5
    deps:
    - path: data/domain/classes.json
      md5: 536eef1578b80119c679abe0e2fe63c7
      size: 77
    - path: data/interim/images_count.json
      md5: cb5f6e38428e031affe368e5e4b64351
      size: 59
    - path: data/interim/train_split.json
      md5: 990315c7d90f4d0d640be37145518a78
      size: 962
    - path: data/interim/val_split.json
      md5: 3a634df5d52902bd59ebd43b98844c22
      size: 222
    - path: src/pipeline/train.py
      md5: 330160fd9b7927109555ac6dbfa9deca
      size: 6704
    outs:
    - path: models/xception_model.h5
      md5: 35b566e4fabfd263a1ed7c103fe2b6f7
      size: 250635496
  setup:
    cmd: python3 src/pipeline/setup.py
